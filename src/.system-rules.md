
This document provides guidelines for both human contributors and AI agents working on SmartHouse. For technical context and architecture details, also see .github/copilot-instructions.md.

Note: This document defines working standards for stability, security, accessibility, and code quality with minimal scope changes.

Table of Contents
General Rules (Stability and Minimal Scope)

Project Structure and Responsibilities

Import Standards (Absolute Aliases vs. Relative Paths)

AI Operating Rules

AI Output Contract (XML)

TypeScript, Lint, Format, and Build (Quality Requirements)

SSR/CSR/Server Actions and Secret Security

Google Sheets Integration (Security and Reliability)

UI/UX, A11y, and Tailwind

Performance and Performance Budget

Testing and Observability

Checklists (Pre-PR and Pre-Deployment)

Minimum Scripts (Recommended)

Date Handling Standard (and Excel Export)

Empty/Nullable Field Handling Rules

React Component & Hook Rules (CRITICAL)

1. General Rules (Stability and Minimal Scope)
Treat every change as critical. Limit the scope to the absolute minimum required by the task.

Do not modify unrelated components, configuration, or dependencies without explicit necessity.

Every change must pass: lint, typecheck, build, and local dev runtime validation.

Prefer small, readable PRs with a clear description and a full diff.

2. Project Structure and Responsibilities
Business Logic:

src/lib/actions.ts – Server Actions/handlers.

src/lib/sheets.ts – Google Sheets integration.

Note: These modules are "server-only" and must not be imported in client-side code.

UI:

General Components: src/components/ui

Functional Components: src/components

Global State:

src/components/main-layout.tsx – MainLayoutContext (providing data and operations, e.g., handleUpdateSettings, handleAddEmployee).

Routing:

According to Next.js conventions (app/ or pages/ – adjust to the repository's actual structure).

3. Import Standards (Absolute Aliases vs. Relative Paths)
Priorities:

Absolute Aliases (Preferred): e.g., import { Foo } from '@/utils/Foo'

Relative (Local): Only for imports from the same folder or close proximity (max 1–2 levels ../).

Never: Long chains of ../../../ – use aliases instead.

Clarity Rules:

If an index.ts/tsx exists in a directory, import the directory (without /index).

Omit file extensions if the bundler allows it.

Change import paths only when necessary (e.g., moving a file). Verify that the target file exists and that all tests pass.

4. AI Operating Rules
Minimal Scope:

Do not touch files outside the task scope.

Do not perform broad refactoring without an explicit request.

Full Files:

When modifying a file, return the entire final content of the file (no diffs), in the XML format described in Section 5.

No Import Errors:

Do not generate code that will cause "Module not found" or type resolution errors.

Internal Validation:

Before sending the response, mentally "run" npm run lint, npm run typecheck, npm run build. The code must pass.

Strict Types:

Use explicit types and interfaces. Avoid any, unless it is a conscious, justified decision with a comment.

Client/Server Boundary:

Do not import server libraries (google-auth-library, google-spreadsheet) in client components ("use client").

All work with secrets—only on the server.

Stability and Compliance:

Respect existing component APIs and type contracts. Introduce breaking changes only with justification and migration steps.

Performance-First:

Use dynamic import for heavy libraries (e.g., recharts, xlsx) and load them only on the client when needed.

A11y-First:

Use semantic HTML, correct ARIA roles, and focus management (especially when using Radix UI).

5. AI Output Contract (XML)
Every proposed file change MUST be returned in the XML format below. Each modified file is a separate <change> node. The file content must be complete (full file), enclosed in CDATA.

XML

<changes>
  <description>[Brief description of the changes being made]</description>
  <change>
    <file>[ABSOLUTE, FULL path to the file, e.g., /src/lib/sheets.ts]</file>
    <content><![CDATA[
[FULL, FINAL FILE CONTENT HERE - no abbreviations, no diffs]
